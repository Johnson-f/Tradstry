---
alwaysApply: true
description: Project structure and architecture guidelines for Tradistry trading platform
---

# Tradstry Project Structure & Architecture

## Overview
Tradistry is a full-stack trading journal and analytics platform with a multi-tenant architecture where each user gets their own isolated database.

## Technology Stack

### Frontend (Next.js)
- **Framework**: Next.js 15 with App Router
- **Language**: TypeScript (strict mode enabled)
- **Styling**: Tailwind CSS with shadcn/ui components
- **State Management**: React Context + custom hooks
- **Authentication**: Supabase Auth
- **Database**: Browser SQLite with Drizzle ORM for offline-first functionality

### Backend (Rust)
- **Framework**: ActixWeb 4.4
- **Database**: Turso (distributed SQLite) with multi-tenant architecture
- **Authentication**: Supabase Auth with JWT validation
- **ORM**: libSQL native driver
- **Error Handling**: anyhow + thiserror

### Infrastructure
- **Primary Database**: Turso (distributed SQLite)
- **Authentication**: Supabase Auth
- **Edge Functions**: Deno-based Supabase Edge Functions

## Project Structure

```
/
├── app/                          # Next.js App Router pages
│   ├── api/                      # API routes
│   ├── auth/                     # Authentication pages
│   └── app/                      # Protected app pages
├── components/                   # React components
│   ├── ui/                       # shadcn/ui components
│   ├── journal/                  # Trading journal components
│   ├── analytics/                # Analytics components
│   ├── market-data/              # Market data components
│   └── notepad/                  # Rich text editor components
├── lib/                          # Utility libraries
│   ├── drizzle/                  # Database schemas and operations
│   ├── services/                 # API service layers
│   ├── hooks/                    # Custom React hooks
│   └── supabase/                 # Supabase client configuration
├── hooks/                        # Global custom hooks
├── backend/                      # Rust backend
│   ├── src/                      # Rust source code
│   │   ├── main.rs               # Application entry point
│   │   ├── routes/               # API route handlers
│   │   ├── models/               # Data models
│   │   ├── service/              # Business logic services
│   │   └── turso/                # Database and auth modules
│   └── database/                 # SQL migration files
└── Edge Functions/               # Supabase Edge Functions
```

## Key Architectural Patterns

### Multi-Tenant Database Architecture
- **Central Registry Database**: Stores user-to-database mappings
- **Individual User Databases**: Each user gets their own isolated Turso database
- **Authentication**: Supabase Auth with JWT-based user identification
- **API Layer**: Rust-based backend with ActixWeb framework

### Frontend Patterns
- **Component Organization**: Feature-based folder structure
- **State Management**: React Context + custom hooks pattern
- **Data Fetching**: SWR for server state, React Query for complex queries
- **Offline-First**: Browser SQLite with Drizzle ORM for local data persistence

### Backend Patterns
- **Route Organization**: Feature-based route modules
- **Error Handling**: Consistent error types with anyhow + thiserror
- **Authentication**: JWT middleware with dual Supabase/Clerk support
- **Database**: libSQL native driver with connection pooling

## File Naming Conventions

### Frontend
- **Components**: PascalCase (e.g., `TradingDashboard.tsx`)
- **Hooks**: camelCase with `use-` prefix (e.g., `use-trading-data.ts`)
- **Services**: camelCase with `-service` suffix (e.g., `trading-service.ts`)
- **Types**: camelCase with `-types` suffix (e.g., `trading-types.ts`)

### Backend
- **Modules**: snake_case (e.g., `trade_notes.rs`)
- **Structs**: PascalCase (e.g., `TradeNote`)
- **Functions**: snake_case (e.g., `create_trade_note`)
- **Constants**: SCREAMING_SNAKE_CASE (e.g., `MAX_TRADE_LIMIT`)

## Import Organization

### Frontend
```typescript
// 1. React and Next.js imports
import React from 'react';
import { useRouter } from 'next/navigation';

// 2. Third-party libraries
import { toast } from 'sonner';
import { Button } from '@/components/ui/button';

// 3. Internal imports (absolute paths with @/)
import { useTradingData } from '@/hooks/use-trading-data';
import { TradingService } from '@/lib/services/trading-service';
```

### Backend
```rust
// 1. Standard library
use std::collections::HashMap;

// 2. Third-party crates
use actix_web::{web, HttpResponse, Result};
use serde::{Deserialize, Serialize};

// 3. Internal modules
use crate::models::TradeNote;
use crate::turso::AppState;
```

## Environment Configuration

### Frontend (.env.local)
```bash
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
NEXT_PUBLIC_API_URL=http://localhost:3000
```

### Backend (.env)
```bash
SUPABASE_URL=your-supabase-url
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
TURSO_DATABASE_URL=your-turso-url
TURSO_AUTH_TOKEN=your-turso-token
PORT=3000
RUST_LOG=info
```

## Development Workflow

### Frontend Development
1. Use `pnpm` for package management
2. Follow TypeScript strict mode requirements
3. Use shadcn/ui components for consistent UI
4. Implement offline-first patterns with browser SQLite
5. Use React Query for server state management

### Backend Development
1. Use `cargo` for dependency management
2. Follow Rust naming conventions and best practices
3. Implement proper error handling with anyhow
4. Use ActixWeb middleware for authentication
5. Maintain multi-tenant database architecture

## Key Principles

1. **Type Safety**: Strict TypeScript configuration, no `any` types
2. **Offline-First**: Browser SQLite for local data persistence
3. **Multi-Tenant**: Isolated user databases for data security
4. **Performance**: Optimized queries and connection pooling
5. **Security**: JWT-based authentication with proper validation
6. **Maintainability**: Clear separation of concerns and consistent patterns
