---
globs: *.rs
---

# Rust Code Conventions

## Code Style
- Use `cargo fmt` for consistent formatting
- Follow Rust naming conventions: snake_case for variables/functions, PascalCase for types
- Use meaningful variable names and avoid abbreviations
- Prefer explicit error handling over unwrap() in production code

## Error Handling
- Use `anyhow::Result` for application-level errors
- Use `thiserror` for custom error types when needed
- Always log errors with appropriate context using the `log` crate
- Return proper HTTP status codes in route handlers

## Database Operations
- Use LibSQL patterns - never use SQLX crates for any database operations
- Always use parameterized queries to prevent SQL injection
- Handle database connection errors gracefully
- Use transactions for multi-step operations

## API Design
- Use consistent `ApiResponse<T>` wrapper for all API responses
- Include proper HTTP status codes (200, 201, 400, 401, 404, 500)
- Validate input data and return meaningful error messages
- Use proper Content-Type headers for JSON responses

## Authentication
- All protected routes must validate Supabase JWT tokens
- Use the authentication middleware pattern from existing routes
- Extract user ID from JWT claims for database operations
- Handle authentication errors with proper HTTP status codes

## Logging
- Use structured logging with appropriate log levels (info, error, warn, debug)
- Include relevant context in log messages (user ID, request ID, etc.)
- Log both successful operations and errors for debugging
- Use consistent log message format across the application